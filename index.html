<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sedon Attila MNANLK 2022 MultiMedia</title>
    <script src="spinTheWheelLogic.js"></script>
    <link rel="stylesheet" href="bulma/bulma.css">
    <link rel="stylesheet" href="spin.css">
</head>
<body>
<h1 class="title">Set up game</h1>
<form id="setupForm">
    <div class="field">
        <label class="label">Name</label>
        <div class="control">
            <input id="nameInput" class="input" type="text" placeholder="Text input">
        </div>
    </div>
    <div class="field">
        <label class="label">Select Difficulty (Changes the speed on the balls)</label>
        <div class="control">
            <div class="select">
                <select id="difficultySelector">
                    <option value="easy">Easy</option>
                    <option value="medium">Medium</option>
                    <option value="hard">Hard</option>
                </select>
            </div>
        </div>
    </div>
    <div id="colorSelectWrapper">
        <div class="field">
            <label class="label">Number of colors (3-6)</label>
            <div class="control">
                <div class="select">
                    <select id="numberOfColorInput">
                        <option value="0">Select One</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
    <div id="buttonWrapper">
        <div class="field">
            <div class="control">
                <button type="submit" id="submit-button" class="button is-link">Submit</button>
            </div>
        </div>
    </div>
</form>
<h1 id="highscoreTitle" class="title">Highscores</h1>
<table class="table is-bordered" id="highscore">
    <thead>
        <tr>
            <th>Name</th>
            <th>Score</th>
        </tr>
    </thead>
    <tbody id="highscoreBody">

    </tbody>
</table>
</body>
<script>
    function createHighScore(){
        const items = { ...localStorage };
        for (let name in items){
            const row = document.createElement("tr");
            row.classList.add("row");
            const nameDiv = document.createElement("td");
            nameDiv.innerText = name;
            const scoreDiv = document.createElement("td");
            scoreDiv.innerText = items[name];
            row.appendChild(nameDiv);
            row.appendChild(scoreDiv);
            const highscoreBody = document.getElementById("highscoreBody");
            highscoreBody.appendChild(row);
        }
    }

    createHighScore();

    function createErrorMessage(message, id, elementToAppendTo){
        if(!document.getElementById("colorSelectError")) {
            const errorMessage = document.createElement("p");
            errorMessage.id = id
            errorMessage.classList.add("help");
            errorMessage.classList.add("is-danger");
            errorMessage.innerText = message;
            elementToAppendTo.appendChild(errorMessage);
        }
    }

    function removeErrorMessage(id, elementToRemoveFrom){
        const errorMessage = document.getElementById(id);
        if(errorMessage){
            elementToRemoveFrom.removeChild(errorMessage);
        }
    }

    function isAllOrNoneOfTheColorButtonInputSet() {
        const vals = Array.from(document.getElementsByClassName("colorButtonInput"))
            .reduce((acc, curr) => {
                return [acc[0] || !!curr.value, acc[1] && !!curr.value]
            }, [false, true])
        return vals[0] === vals[1]
    }

    const validColors = ["Red", "Green", "Blue", "Cyan", "Yellow", "Magenta"]
    const form = document.getElementById("setupForm");
    const colorSelectWrapper = document.getElementById("colorSelectWrapper");
    const numberOfColorsInput = document.getElementById("numberOfColorInput");
    numberOfColorsInput.addEventListener("change", function(e){
        const oldWrapper = document.getElementById("colorWrapper")
        if(oldWrapper){
            colorSelectWrapper.removeChild(oldWrapper)
        }
        const wrapper = document.createElement("div");
        wrapper.id = "colorWrapper";
        const numberOfColorsValue = e.target.value;
        for(let i = 0; i < parseInt(numberOfColorsValue); i++){
            const field = document.createElement("div");
            field.id = validColors[i];
            field.classList.add("field");
            field.innerHTML = `<label class="label">${validColors[i]}</label>
                                 <div class="control">
                                   <input id="${validColors[i]}Input" class="input colorButtonInput" type="text">
                               </div>`

            field.addEventListener("change", function (e){
                let errorId = `errorMessage${validColors[i]}`;
                if (e.target.value.length > 1){
                    createErrorMessage("Choose only one or no letters", errorId, field);
                } else {
                    removeErrorMessage(errorId, field)
                }
            })
            wrapper.appendChild(field);
        }
        colorSelectWrapper.appendChild(wrapper);
    })

    const button = document.getElementById("submit-button");
    const buttonWrapper = document.getElementById("buttonWrapper");
    form.addEventListener("submit", function (e){
        console.log(e.target);
        e.preventDefault();

        const numberOfColorInput = document.getElementById("numberOfColorInput");
        const nameInput = document.getElementById("nameInput");
        const colorSelectorErrorId = "colorSelectError";
        const setAllOrNoneErrorId = "setAllOrNoneError";
        const noNameErrorId = "noNameError";

        [colorSelectorErrorId, setAllOrNoneErrorId].forEach(e => {
            removeErrorMessage(e, buttonWrapper);
        });

        if(numberOfColorInput.value === "0"){
            createErrorMessage("You should choose how many colors you want", colorSelectorErrorId, buttonWrapper);
            return;
        } else if(!isAllOrNoneOfTheColorButtonInputSet()){
            createErrorMessage("Either set all of the buttons or don't set any of them", setAllOrNoneErrorId, buttonWrapper);
            return;
        } else if(nameInput.value === "") {
            createErrorMessage("Set a name", noNameErrorId, buttonWrapper);
            return;
        }

        const difficulty = document.getElementById("difficultySelector").value;
        const numberOfColors = numberOfColorInput.value;
        const name = nameInput.value;
        const keybindings = {};
        validColors.forEach(validColor => {
            const input = document.getElementById(`${validColor}Input`);
            if(input){
                keybindings[input.value] = validColor;
            }
        });

        const body = document.getElementsByTagName("body")[0];
        const titles = document.getElementsByClassName("title")[0];
        const table = document.getElementById("highscore");
        body.removeChild(titles[0]);
        body.removeChild(titles[1]);
        body.removeChild(form);
        body.removeChild(table);
        setUpGameWorld(difficulty, numberOfColors, keybindings, name);
    });

</script>
</html>